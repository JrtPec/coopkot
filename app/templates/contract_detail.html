<!-- extend base layout -->
{% extends "base.html" %}

{% block content %}
{% include 'flash.html' %}
<style type="text/css">
#ledger {
    background-color:rgba(255, 255, 255, 0.5);
}
</style>

<div class="well well-large">
    <h1>Contract detail for contract n°{{contract.id}}</h1>

    <p>Contract start date: {{contract.start_date.date()}}</p>
    <p>Contract end date: {{contract.end_date.date()}}</p>
</div>
<div class="well well-large">
    <h4>User: {{user.nickname}}</h4>
    {% if user.about_me %}
    <p>About: {{user.about_me}}</p>
    {% endif %}
    <h4>Property: {{property.name}}</h4>
    {% if property.info %}
    <p>info: {{property.info}}</p>
    {% endif %}
    <h4>Room: {{room.name}}</h4>
    {% if room.info %}
    <p>info: {{room.info}}</p>
    {% endif %}
</div>
<div class='well well-large'>
    {% for month in months %}
    <div>
        <h2>{{month.start_date.strftime("%B %Y")}}</h2>
        <p><em>{{month.start_date.strftime("%d %b '%y")}} - {{month.end_date.strftime("%d %b '%y")}}</em></p>
        <h3>Total: € {{month.cost_total}}</h3>
        <div class="well well-large" id="ledger">
            <h3>Electricity</h3>
            <table class="table table-hover">
                <tr>
                    <th>Name</th>
                    <th>Total Usage (kWh)</th>
                    <th>Shared by</th>
                    <th>Usage (kWh)</th>
                    <th>Price (€/kWh)</th>
                    <th>Cost</th>
                </tr>
                {% for usage in month.usages %}
                {% if usage.datastream.type == 0 %}
                <tr>
                    <td><p>{{usage.datastream.info}}</p></td>
                    {% if usage.shared != 1 %}
                    <td><p>{{usage.total_value}}</p></td>
                    <td><p>{{usage.shared}}</p></td>
                    {% else %}
                    <td></td>
                    <td></td>
                    {% endif %}
                    <td><p>{{usage.value}}</p></td>
                </tr>
                {% endif %}
                {% endfor %}
                <tr>
                    <td></td>
                    <td></td>
                    <td><p><b>TOTAL</b></p></td>
                    <td><p><b>{{month.total_e}}</b></p></td>
                    <td><p><b>{{property.get_historical_prices(month.start_date).electricity/100}}</b></p></td>
                    <td><p><b>€ {{month.cost_e}}</b></p></td>
                </tr>
            </table>
        </div>
        <div class="well well-large" id="ledger">
            <h3>Heat</h3>
            <table class="table table-hover">
                <tr>
                    <th>Name</th>
                    <th>Total Usage (kWh)</th>
                    <th>Shared by</th>
                    <th>Usage (kWh)</th>
                    <th>Price (€/kWh)</th>
                    <th>Cost</th>
                </tr>
                {% for usage in month.usages %}
                {% if usage.datastream.type == 1 %}
                <tr>
                    <td><p>{{usage.datastream.info}}</p></td>
                    {% if usage.shared != 1 %}
                    <td><p>{{usage.total_value}}</p></td>
                    <td><p>{{usage.shared}}</p></td>
                    {% else %}
                    <td></td>
                    <td></td>
                    {% endif %}
                    <td><p>{{usage.value}}</p></td>
                </tr>
                {% endif %}
                {% endfor %}
                <tr>
                    <td></td>
                    <td></td>
                    <td><p><b>TOTAL</b></p></td>
                    <td><p><b>{{month.total_h}}</b></p></td>
                    <td><p><b>{{property.get_historical_prices(month.start_date).heat/100}}</b></p></td>
                    <td><p><b>€ {{month.cost_h}}</b></p></td>
                </tr>
            </table>
        </div>
        <div class="well well-large" id="ledger">
            <h3>Water</h3>
            <table class="table table-hover">
                <tr>
                    <th>Name</th>
                    <th>Total Usage (m<sup>3</sup>)</th>
                    <th>Shared by</th>
                    <th>Usage (m<sup>3</sup>)</th>
                    <th>Price (€/m<sup>3</sup>)</th>
                    <th>Cost</th>
                </tr>
                {% for usage in month.usages %}
                {% if usage.datastream.type == 2 %}
                <tr>
                    <td><p>{{usage.datastream.info}}</p></td>
                    {% if usage.shared != 1 %}
                    <td><p>{{usage.total_value}}</p></td>
                    <td><p>{{usage.shared}}</p></td>
                    {% else %}
                    <td></td>
                    <td></td>
                    {% endif %}
                    <td><p>{{usage.value}}</p></td>
                </tr>
                {% endif %}
                {% endfor %}
                <tr>
                    <td></td>
                    <td></td>
                    <td><p><b>TOTAL</b></p></td>
                    <td><p><b>{{month.total_w}}</b></p></td>
                    <td><p><b>{{property.get_historical_prices(month.start_date).water/100}}</b></p></td>
                    <td><p><b>€ {{month.cost_w}}</b></p></td>
                </tr>
            </table>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}